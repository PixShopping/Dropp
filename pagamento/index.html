<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Mvshop | Pagamento </title>
    <link rel="stylesheet" href="./style.css">
    <link rel="shortcut icon" href="../src/img/favicon.png" type="image/x-icon">
</head>

<body>
    
    <header class="navgation">

        <img src="../src/img/logoPagamento.png">

        <div class="seguro">
            <div class="flex">
                <p>Compra 100% Segura <ion-icon name="lock-closed-outline"></ion-icon></p>
            </div>
            <div class="flex">
                <p>Garantia de 30 Dias direto em <strong>Nossa Loja</strong></p>
            </div>    
        </div>

    </header>

    <main class="container">

        <article class="produto">



        </article>


        <!-- IDENTIFICAÇÃO -->
        <section class="formulario identificacao">

            <div class="progresso">
                <div class="column">
                    <a class="selecionadoFundo">1</a>
                    <p class="selecionadoCor">Informações <br> pessoais</p>
                </div>
                <div class="column">
                    <a>2</a>
                    <p>Entrega</p>
                </div>
                <div class="column">
                    <a>3</a>
                    <p>Pagamento</p>
                </div>
            </div>

            <!-- Fomulario de identificação -->
            <article class="form">

                <h1><span>1</span>Identifique-se</h1>

                <label for="nome">Nome Completo</label>
                <input id="nome" placeholder="ex: Vitor Custodio da Silva" type="text">

                <label for="email">E-mail</label>
                <input id="email" placeholder="ex: vitor@gmail.com" type="text">

                <label for="cpf">CPF</label>
                <input oninput="validarCpf()" type="tel" id="cpf" placeholder="000.000.000-00">

                <label for="telefone">Celular / WhatsApp</label>
                <input oninput="validarTelefone()" type="tel" id="telefone" placeholder="(00) 00000-0000">

                <button onclick="salvarIdentidade()">Continuar</button>

            </article>

        </section>


        <!-- ENTREGA -->
        <section class="formulario entrega">

            <div class="progresso">
                <div class="column">
                    <a>1</a>
                    <p>Informações <br> pessoais</p>
                </div>
                <div class="column">
                    <a class="selecionadoFundo">2</a>
                    <p class="selecionadoCor">Entrega</p>
                </div>
                <div class="column">
                    <a>3</a>
                    <p>Pagamento</p>
                </div>
            </div>

            <!-- Fomulario de Entrega -->
            <article class="form">

                <h1><span>2</span>Identifique-se</h1>

                <label for="cep">CEP</label>
                <input oninput="validarCEP()" id="cep" placeholder="00000-000" type="text">

                <div class="column" id="mostrarCep">

                    <label for="rua">Rua</label>
                    <input id="rua" type="text" disabled>

                    <label for="cidade">Cidade</label>
                    <input id="cidade" type="text" disabled>

                    <label for="estado">Estado</label>
                    <input id="estado" type="text" disabled>

                    <label for="descricao">Descrição</label>
                    <textarea id="descricao"></textarea>

                </div>
                
                <h1 class="none" id="erroCEP"></h1>

                <button onclick="salvarEntrega()">Continuar</button>
                <a onclick="abrirForm('identificacao')">Voltar</a>
                
            </article>

        </section>


        <!-- PAGAMENTO -->
        <section class="formulario pagamento">

            <div class="progresso">
                <div class="column">
                    <a>1</a>
                    <p>Informações <br> pessoais</p>
                </div>
                <div class="column">
                    <a>2</a>
                    <p>Entrega</p>
                </div>
                <div class="column">
                    <a class="selecionadoFundo">3</a>
                    <p class="selecionadoCor">Pagamento</p>
                </div>
            </div>

        </section>

        

    </main>

    <footer class="creditos">

        <p>Mv Outlet: mvoutlet.netlift.app</p>
        <p>© MVoutlet - CNPJ: 42.334.245/0001-24</p>

    </footer>


</body>

    <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-storage-compat.js"></script>
    <!-- JAVASCRIPT -->
    <script>


        // TELEFONE
        function validarTelefone() {
            const inputNumero = document.getElementById("telefone");
            const numero = inputNumero.value.replace(/\D/g, '');
            const formatoTELEFONE = '($1) $2-$3';

            if (!/^\d+$/.test(numero)) {
                inputNumero.value = inputNumero.value.slice(0, inputNumero.value.length - 1);
                return;
            }

            // Adiciona parênteses e hífen após 11 dígitos
            if (numero.length === 11) {
                inputNumero.value = numero.replace(/^(\d{2})(\d{5})(\d{4})$/, formatoTELEFONE);
            } else if (numero.length > 11) {
                inputNumero.value = inputNumero.value.slice(0, 15);
            }
        }

        // CPF
        function validarCpf() {
            const inputNumero = document.getElementById("cpf");
            const numero = inputNumero.value.replace(/\D/g, ''); // Remove não dígitos
            const formatoCPF = '$1.$2.$3-$4';

            const cpfRegex = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/;

            if (!/^\d+$/.test(inputNumero.value)) {
                inputNumero.value = inputNumero.value.slice(0, inputNumero.value.length - 1);
                return;
            }

            // Adiciona parênteses e hífen após 11 dígitos
            if (numero.length === 11) {
                inputNumero.value = numero.replace(/^(\d{3})(\d{3})(\d{3})(\d{2})$/, formatoCPF)
            } else if (numero.length > 11) {
                inputNumero.value = inputNumero.value.slice(0, 15);
            }

        }

        async function validarCEP() {
            const inputCep = document.getElementById('cep');
            const cep = document.getElementById('cep').value.replace(/\D/g, '');
            
            if (!/^\d+$/.test(cep)) {
                inputCep.value = inputCep.value.slice(0, inputCep.value.length - 1);
                return;
            }

            if (cep.length === 8) {
                await consultarCEP(cep);
                inputCep.value = cep.replace(/^(\d{5})(\d{3})$/, "$1-$2");
            } else if (cep.length > 8) {
                inputCep.value = inputCep.value.slice(0, 8);
            }

        }




        // BANCO DE DADOS
        const firebaseConfig = {
            apiKey: "AIzaSyBqbDhvZYwoJng6u2AF-YHTBBCPWiYAnuY",
            authDomain: "dropp-71540.firebaseapp.com",
            projectId: "dropp-71540",
            storageBucket: "dropp-71540.appspot.com",
            messagingSenderId: "226605796065",
            appId: "1:226605796065:web:7b6a8652ed1e93d78f45a0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        function abrirForm(classe) {
            const identidade = document.querySelector('.identificacao');
            const entrega = document.querySelector('.entrega');
            const pagamento = document.querySelector('.pagamento');
            identidade.style.display = "none";
            entrega.style.display = "none";
            pagamento.style.display = "none";
            document.querySelector(`.${classe}`).style.display = "flex";
        }

        function salvarIdentidade() {

            const cep = document.getElementById('cep').value.replace(/\D/g, '');
            consultarCEP(cep);
            abrirForm('entrega');
        }

        function salvarEntrega() {
            abrirForm('pagamento');
        }


        function consultarCEP(cep) {
            const mostrarCep = document.getElementById('mostrarCep');
            const rua = document.getElementById('rua');
            const cidade = document.getElementById('cidade');
            const estado = document.getElementById('estado');
            const erroCEP = document.getElementById('erroCEP');

            // URL da API do ViaCEP
            const apiUrl = `https://viacep.com.br/ws/${cep}/json/`;

            // Fazendo requisição GET usando fetch
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    // Verifica se a resposta da API contém informações válidas
                    if (!data.erro) {
                        mostrarCep.style.display = "flex";
                        rua.value = data.logradouro;
                        cidade.value = data.localidade;
                        estado.value = data.uf;
                        erroCEP.style.display = "none";
                    } else {
                        erroCEP.style.display = "flex";
                        erroCEP.innerHTML = 'CEP não encontrado';
                        console.error('CEP não encontrado');
                    }
                })
                .catch(error => {
                    console.error('Erro na consulta de CEP:', error);
                });
        }


    </script>

<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

</html>