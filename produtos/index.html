<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> MVoutlet | Produtos </title>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="../global.css">
    <link rel="shortcut icon" href="../src/img/favicon.png" type="image/x-icon">
</head>

<body>
    
    <!-- ANUNCIO -->
    <div class="anuncio">
        <ion-icon name="bicycle-outline"></ion-icon>
        <p>Frete grátis em todo o Brasil</p>
    </div>
    
    <!-- NAVGATION -->
    <header class="navgation">
        <ion-icon onclick="abrirMenu()" class="btn-menu" id="openMenu" name="menu"></ion-icon>
        <ion-icon onclick="fecharMenu()" class="btn-menu" id="closeMenu" name="close"></ion-icon>

        <img id="logo" src="../src/img/logo.png">

        <div class="flex pesquisa">
            <input onkeydown="pressionarEnter(event, 'buscar')" placeholder="O que está buscando?" type="text" id="buscar">
            <ion-icon onclick="pesquisar('buscar')" name="search"></ion-icon>
        </div>

        <div class="pesquisaMobile">
            <input onkeydown="pressionarEnter(event, 'buscarMobile')" placeholder="O que está buscando?" type="text" id="buscarMobile">
            <ion-icon onclick="pesquisar('buscarMobile')" name="search"></ion-icon>
        </div>

        <div class="flex buttons">
            <ion-icon onclick="abrirURL('rastreio/')" name="location-outline"></ion-icon>
            <ion-icon onclick="abrirURL('carrinho/')" name="cart-outline"></ion-icon>
        </div>
    </header>


    <!-- LINKS -->
    <nav class="links">
        <ul>
            <div class="triangulo"></div>
            <li>
                <a href="../index.html">home</a>
            </li>
            <li>
                <a href="../produtos/">produtos</a>
            </li>
            <li>
                <a href="../index.html#sobre">sobre nós</a>
            </li>
            <li>
                <a href="../rastreio/">rastrear pedido</a>
            </li>
        </ul>
    </nav>

    <main class="container">

        <div class="flex">
            <h1 id="nomePesquisa">Resultados</h1>
            <h2><a id="resultadoPesquisa">0</a> Resultados</h2>

        </div>
        
        <section class="produtos">


        </section>

    </main>

    <article class="content-produto">
        
        <section class="left">
            
            <div class="imagens">
                <div class="imagemPrincipal"></div>
                <div class="imagemSecundaria"></div>
            </div>
            
            <div class="descricaoDesktop descricao">

            </div>

        </section>
        
        <section class="right">
            
            <div class="nome">

            </div>
            <div class="tamanho">
                <p>Tamanho:</p>
                <div class="tamanhosInputs">
                    
                </div>
            </div>
            <div class="cores">
                <p>Cor:</p>
                <div class="coresInputs">
                    
                </div>
            </div>
            <div class="pagamentos">
                <p>Pagamentos:</p>
                <div class="pagamentosInputs">
                    
                </div>
            </div>
            <div class="preco">
                
            </div>
    
            <div class="botoes">
                
            </div>
            

        </section>
        
        <div class="descricaoMobile descricao">

        </div>

    </article>

    <div class="avaliacoes">

        <h1>Avaliações dos Clientes</h1>

        <section class="quantidade">
            
            <div class="flex">

                <h2 id="notaFinal">5 / 5</h2>
                <section id="notadoprodutodois" class="flex">
                    <ion-icon name="star"></ion-icon>
                    <ion-icon name="star"></ion-icon>
                    <ion-icon name="star"></ion-icon>
                    <ion-icon name="star"></ion-icon>
                    <ion-icon name="star"></ion-icon>
                </section>
                
            </div>

            <button id="btnMostrar" onclick="mostrarAvaliacao()">Avaliar Produto</button>
            <button id="btnFechar" class="none" onclick="fecharAvaliacao()">Avaliar Produto</button>
            
        </section>
        
        <div class="formulario">
                
            <label for="nome">Nome <strong for="nome">*</strong></label>
            <input placeholder="ex: Vitor" maxlength="20" id="nome" type="text">

            <label for="estrelas">Avaliação <strong id="mostrarNota" for="estrelas">*</strong></label>
            <div class="flex">

                <div class="column">
                    <h1>0</h1>
                    <input oninput="notaAvaliacao('0')" name="estrelas" type="radio">
                    <ion-icon name="star"></ion-icon>
                </div>
                <div class="column">
                    <h1>1</h1>
                    <input oninput="notaAvaliacao('1')" name="estrelas" type="radio">
                    <ion-icon name="star"></ion-icon>
                </div>
                <div class="column">
                    <h1>2</h1>
                    <input oninput="notaAvaliacao('2')" name="estrelas" type="radio">
                    <ion-icon name="star"></ion-icon>
                </div>
                <div class="column">
                    <h1>3</h1>
                    <input oninput="notaAvaliacao('3')" name="estrelas" type="radio">
                    <ion-icon name="star"></ion-icon>
                </div>
                <div class="column">
                    <h1>4</h1>
                    <input oninput="notaAvaliacao('4')" name="estrelas" type="radio">
                    <ion-icon name="star"></ion-icon>
                </div>
                <div class="column">
                    <h1>5</h1>
                    <input oninput="notaAvaliacao('5')" name="estrelas" type="radio" checked>
                    <ion-icon name="star"></ion-icon>
                </div>

            </div>
            
            <label for="imagem">Imagem <strong for="imagem">*</strong></label>
            <input id="imagem" type="file" accept="image">

            <label for="comentario">Comentario <strong for="comentario">*</strong></label>
            <textarea placeholder="ex: Gostei muito :)" maxlength="200" id="comentario"></textarea>

            <button onclick="enviarAvaliacao()">Enviar Avaliação</button>

        </div>

        <section class="comentarios">

            

        </section>

    </div>



    <!-- CONTATO -->
    <footer class="contato">
        <article>    
                        
            <section class="assine">
                <h1>MVoutlet</h1>
                <p>Assine já nosso plano VIP para garantir recompensas e cupons para nossa loja.</p>
                <input placeholder="Seu E-mail" type="text">
                <button>Enviar</button>
            </section>

            <section class="suporte">
                <h1>Suporte ao Cliente</h1>
                <li>
                    <p><strong>Email</strong>: mvoutlet.br@gmail.com</p>
                </li>
                <li>
                    <p><strong>Whatsapp</strong>: +55 (16) 997569308</p>
                </li>
                <li>
                    <p><strong>Telefone</strong>: (16) 3324-1234</p>
                </li>
                <li>
                    <p><strong>Instagram</strong>: @mvoutlet.br</p>
                </li>
                <li>
                    <p><strong>Facebook</strong>: MVoutlet_</p>
                </li>
            </section>

        </article>

        <div class="linha"></div>

        <section class="direitos">
            
            <div class="flex">
                <ion-icon onclick="abrirURL('https://instagram.com/mvoutlet.br')" name="logo-instagram"></ion-icon>
                <ion-icon onclick="abrirURL('https://facebook.com/MVoutlet_')" name="logo-facebook"></ion-icon>
                <ion-icon onclick="abrirURL('https://wa.me/5516997569308')" name="logo-whatsapp"></ion-icon>
            </div>

            <p>© MVoutlet 2023</p>

            <div class="flex">
                <ion-icon name="logo-javascript"></ion-icon>
                <ion-icon name="logo-firebase"></ion-icon>
            </div>
        
        </section>
    </footer>

    </body>

    <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.3.0/firebase-storage-compat.js"></script>
    <!-- JAVASCRIPT -->
    <script>


        // DEFINIR NOTA DA AVALICAO
        function notaAvaliacao(nota) {
            const mostrarNota = document.getElementById('mostrarNota');
            mostrarNota.style.color = "var(--verde)";
            mostrarNota.innerHTML = `${nota} / 5`;
        }

        
        // BANCO DE DADOS
        const firebaseConfig = {
            apiKey: "AIzaSyBqbDhvZYwoJng6u2AF-YHTBBCPWiYAnuY",
            authDomain: "dropp-71540.firebaseapp.com",
            projectId: "dropp-71540",
            storageBucket: "dropp-71540.appspot.com",
            messagingSenderId: "226605796065",
            appId: "1:226605796065:web:7b6a8652ed1e93d78f45a0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        const loja = 'teste';

        const botoes = document.querySelector('.buttons');
        const email = localStorage.getItem('email');
        const senha = localStorage.getItem('senha');

        // BOTAO DO MENU
        function abrirMenu() {
            const openMenu = document.getElementById('openMenu');
            const closeMenu = document.getElementById('closeMenu');
            openMenu.style.display = "none";
            closeMenu.style.display = "flex";

            const menu = document.querySelector('.links ul');
            menu.style.display = "flex";
            setTimeout(() => {
                menu.style.opacity = 1;
            }, 200);
        }

        function fecharMenu() {
            const openMenu = document.getElementById('openMenu');
            const closeMenu = document.getElementById('closeMenu');
            openMenu.style.display = "flex";
            closeMenu.style.display = "none";

            const menu = document.querySelector('.links ul');
            menu.style.opacity = 0;
            
            setTimeout(() => {
                menu.style.display = "none";
            }, 200);
        }

        function mostrarAvaliacao() {
            const formulario = document.querySelector('.avaliacoes .formulario');
            const btnMostrar = document.getElementById('btnMostrar');
            const btnFechar = document.getElementById('btnFechar');
            btnMostrar.style.display = "none";
            btnFechar.style.display = "block";
            formulario.style.display = "flex";
            setTimeout(() => {
                formulario.style.setProperty('opacity', 1, 'important');
            }, 500);
        }

        function fecharAvaliacao() {
            const formulario = document.querySelector('.avaliacoes .formulario');
            const btnMostrar = document.getElementById('btnMostrar');
            const btnFechar = document.getElementById('btnFechar');
            btnMostrar.style.display = "block";
            btnFechar.style.display = "none";
            formulario.style.setProperty('opacity', 0, 'important');
            setTimeout(() => {
                formulario.style.display = "none";    
            }, 1000);
        }

        // ABRIR PRODUTO
        function abrirProduto(nome) {
            window.location.href = `../produtos/?produto=${nome}`;
        }

        // Adicionar ao carrinho
        async function adicionarCarrinho(nome, dados) {
            const email = localStorage.getItem('email');
            const senha = localStorage.getItem('senha');
            if (email && senha) {
                await db.collection('usuarios')
                .doc(email)
                .collection('carrinho')
                .doc(nome).set({
                    dados: dados,
                }).then((response) => {
                    window.location.href = "../carrinho/";
                })
            } else {
                window.location.href = await "../carrinho/";
            } 
        }

        carregarLoja();
        async function carregarLoja() {
            const root = document.documentElement;
            const navgation = document.querySelector('.navgation');
            const links = document.querySelector('.links ul');
            const contato = document.querySelector('.contato');
            const anuncio = document.querySelector('.anuncio');
            const produtos = document.querySelector('.produtos');
            const container = document.querySelector('.container');
            
            // PRODUTOS
            const searchTerm = getParameterByName('search');
            var count = 0;
            const nomePesquisa = document.getElementById('nomePesquisa');
            const resultadoPesquisa = document.getElementById('resultadoPesquisa');
            await db.collection('produtos')
            .onSnapshot((data) => {
                data.docs.map((val) => {
                    //const porcentagem = val.data().porcentagem;
                    const nome = val.id;
                    const nomeBusca = nome.toLowerCase();
                    const precoNovo = val.data().precoNovo;
                    const precoAntigo = val.data().precoAntigo;
                    var porcentagem = parseFloat(precoNovo.replace(",", ".")) / parseFloat(precoAntigo.replace(",", "."));
                    porcentagem *= 100;
                    porcentagem = porcentagem.toFixed(2);
                    porcentagem -= 100 // Arredonda para duas casas decimais
                    porcentagem = porcentagem.toFixed(2);
                    porcentagem = Math.abs(porcentagem);
                    porcentagem = porcentagem + "%";
                    const imagem = val.data().imagem;
                    const storageRef = storage.ref().child(`produtos/${nome}/${imagem}`);
                    storageRef.getDownloadURL().then( function(url) {
                        if (searchTerm) {
                            nomePesquisa.innerHTML = `Resultados com "${searchTerm}"`;
                            if (nomeBusca.includes(searchTerm)) {
                                produtos.innerHTML += `
                                    <div class="produto">
                                        <div class="porcentagem">
                                            <ion-icon name="arrow-down"></ion-icon>
                                            <a>${porcentagem}</a>    
                                        </div>
                                        <img src="${url}">
                                        <div class="produtoMobile">
                                            <h1>${nome}</h1>
                                            <h2>R$${precoNovo} <span>R$${precoAntigo}</span></h2>
                                            <button onclick="abrirProduto('${nome}')" class="btn-comprar">Comprar</button>
                                            <button onclick="adicionarCarrinho('${nome}','${nome}')" class="btn-addCarrinho">Adicionar ao carrinho</button>
                                        </div>
                                        <div class="produtoDesktop">
                                            <button onclick="abrirProduto('${nome}')" class="btn-comprar">Comprar</button>
                                        </div>
                                    </div>
                                `;  
                                count++;
                            }
                        } else {
                            nomePesquisa.innerHTML = `Resultados`;
                            produtos.innerHTML += `
                                <div class="produto">
                                    <div class="porcentagem">
                                        <ion-icon name="arrow-down"></ion-icon>
                                        <a>${porcentagem}</a>    
                                    </div>
                                    <img src="${url}">
                                    <div class="produtoMobile">
                                        <h1>${nome}</h1>
                                        <h2>R$${precoNovo} <span>R$${precoAntigo}</span></h2>
                                        <button onclick="abrirProduto('${nome}')" class="btn-comprar">Comprar</button>
                                        <button onclick="adicionarCarrinho('${nome}','${nome}')" class="btn-addCarrinho">Adicionar ao carrinho</button>
                                    </div>
                                    <div class="produtoDesktop">
                                        <button onclick="abrirProduto('${nome}')" class="btn-comprar">Comprar</button>
                                    </div>
                                </div>
                            `;
                            count++;
                        }
                        resultadoPesquisa.innerHTML = count; 
                        if (count === 0) {
                            container.innerHTML = `
                                <h3>Nenhum resultado com "${searchTerm}" encontrado</h1>
                                <img src="../src/img/notfind.png">
                                <button onclick="abrirURL('index.html')" class="btn-comprar voltar">Voltar para o início</button>
                            `;
                        }
 
                    });
                });
            });
        }  
        
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "))
        }

        function abrirURL(url) {
            window.location.href = `../${url}`;
        }

        /* Metodo de busca */
        async function pesquisar(id) {
            const buscar = await document.getElementById(id).value.toLowerCase().replace(/\s/g, '');
            window.location.href = "../produtos/?search=" + encodeURIComponent(buscar);
        }

        /* Adicionando evento de click do teclado */
        function pressionarEnter(event, id) {
            if (event.key === "Enter") {
                pesquisar(id);
            }
        }

        /* METODO DE PAGAMENTO */

        async function metodoPagamento(metodo, url) {
            const comprar = await document.getElementById('comprar');
            comprar.style.display = "block";
            comprar.innerHTML = await `Comprar com ${metodo}`;
            await comprar.addEventListener('click', () => {
                window.location.href = url;
            });
        }

        
        const termProduto = getParameterByName('produto');
        const container = document.querySelector('.container');
        const content = document.querySelector('.content-produto');
        const divImagemPrincipal = document.querySelector('.imagemPrincipal');
        const divImagemSecundaria = document.querySelector('.imagemSecundaria');
        const divDescricao = document.querySelectorAll('.descricao');
        const divNome = document.querySelector('.nome');
        const divTamanho = document.querySelector('.tamanhosInputs');
        const divCores = document.querySelector('.coresInputs');
        const divPagamentos = document.querySelector('.pagamentosInputs');
        const divPreco = document.querySelector('.preco');
        const divBotoes = document.querySelector('.botoes');
        const avaliacoes = document.querySelector('.avaliacoes');
        const comentarios = document.querySelector('.comentarios');
        
        if (termProduto) {
            container.style.display = "none";
            content.style.display = "flex";
            lerProduto(termProduto);
        }

        function selecionarImagem(url) {
            const imagemSelecionada = document.getElementById('imagemSelecionada');
            imagemSelecionada.src = url;
        }


        function pagamento(url) {
            window.location.href = url;
        }

        var soma = 0;
        var notas = 0;
        var pessoas = 0;
        async function lerProduto(produto) {

            // IMAGENS
            await db.collection('produtos')
            .doc(produto)
            .collection('imagens')
            .orderBy('id', 'asc')
            .onSnapshot((data) => {
                divImagemPrincipal.innerHTML += `
                    <img id="imagemSelecionada" src="">
                `;
                data.docs.map((val) => {
                    const imagem = val.id;
                    const storageRef = storage.ref().child(`produtos/${produto}/${imagem}`);
                    storageRef.getDownloadURL().then( function(url) {
                        divImagemSecundaria.innerHTML += `
                            <img onclick="selecionarImagem('${url}')" src="${url}">
                        `;
                        const imagemSelecionada = document.getElementById('imagemSelecionada');
                        imagemSelecionada.src = url;
                    });
                });
            });

            // DESCRICÃO
            await db.collection('produtos')
            .doc(produto)
            .get().then((val) => {
                const descricao = val.data().descricao;
                divDescricao.forEach((div) => {
                    div.innerHTML += `
                        <h1>Descrição</h1> 
                        <p>${descricao}</p>
                    `; 
                });
            });
            
            // NOME E AVALIAÇÕES
            await db.collection('produtos')
            .doc(produto)
            .get().then((val) => {
                const nome = val.id;
                const precoNovo = val.data().precoNovo;
                const precoAntigo = val.data().precoAntigo;
                var porcentagem = parseFloat(precoNovo.replace(",", ".")) / parseFloat(precoAntigo.replace(",", "."));
                porcentagem *= 100;
                porcentagem = porcentagem.toFixed(2);
                porcentagem -= 100 // Arredonda para duas casas decimais
                porcentagem = porcentagem.toFixed(2);
                porcentagem = Math.abs(porcentagem);
                porcentagem = porcentagem + "%";
                const imagem = val.data().imagem;
                const storageRef = storage.ref().child(`produtos/${nome}/${imagem}`);
                storageRef.getDownloadURL().then( function(url) {
                    divNome.innerHTML += `
                        <div class="flex">
                            <h1>${nome}</h1>
                            <ion-icon class="verificado" name="checkmark-circle"></ion-icon>
                        </div>
                        <div class="flex">
                            <section id="notadoproduto">
                                <ion-icon class="estrela" name="star"></ion-icon>
                                <ion-icon class="estrela" name="star"></ion-icon>
                                <ion-icon class="estrela" name="star"></ion-icon>
                                <ion-icon class="estrela" name="star"></ion-icon>
                                <ion-icon class="estrela" name="star"></ion-icon>
                            </section>
                            <h2 id="pessoasFinal">0 Avaliações</h2>
                        </div>
                    `;
                    carregarAvaliacoes(produto);
                });
            });


            // TAMANHO
            await db.collection('produtos')
            .doc(produto)
            .collection('tamanhos')
            .orderBy('id', 'asc')
            .onSnapshot((data) => {
                data.docs.map((val) => {
                    const tamanho = val.id;
                    divTamanho.innerHTML += `
                        <div class="bloco">    
                            <input id="${tamanho}" type="radio" name="tamanhos">
                            <div>${tamanho}</div>    
                        </div>
                    `;
                }); 
            });

            // CORES
            await db.collection('produtos')
            .doc(produto)
            .collection('cores')
            .orderBy('id', 'asc')
            .onSnapshot((data) => {
                data.docs.map((val) => {
                    const cor = val.id;
                    divCores.innerHTML += `
                        <div class="bloco">    
                            <input id="${cor}" type="radio" name="cores">
                            <div>${cor}</div>    
                        </div>
                    `;
                });
            });

            // PAGAMENTOS
            await db.collection('produtos')
            .doc(produto)
            .collection('pagamentos')
            .orderBy('id', 'asc')
            .onSnapshot((data) => {
                data.docs.map((val) => {
                    const metodo = val.id;
                    const icon = val.data().icon;
                    const url = val.data().url;
                    divPagamentos.innerHTML += `
                        <div class="bloco">    
                            <input onchange="metodoPagamento('${metodo}','${url}')" id="${metodo}" type="radio" name="pagamentos">
                            <div class="flex">
                                <ion-icon name="${icon}"></ion-icon>
                                <p>${metodo}</p>
                            </div>
                        </div>
                    `;
                });
            });

            // PREÇO
            await db.collection('produtos')
            .doc(produto)
            .get().then((val) => {
                const precoNovo = val.data().precoNovo;
                const precoAntigo = val.data().precoAntigo;
                /*var porcentagem = parseFloat(precoNovo.replace(",", ".")) / parseFloat(precoAntigo.replace(",", "."));
                porcentagem *= 100;
                porcentagem = porcentagem.toFixed(2);
                porcentagem -= 100 // Arredonda para duas casas decimais
                porcentagem = porcentagem.toFixed(2);
                porcentagem = Math.abs(porcentagem);
                porcentagem = porcentagem + "%";
                */
                var desconto = parseFloat(precoAntigo.replace(",", ".")) - parseFloat(precoNovo.replace(",", "."));
                desconto = desconto.toFixed(0);
                divPreco.innerHTML += `
                    <h1>Preço:</h1> 
                    <h2>
                        <span>De R$ ${precoAntigo}</span>
                        R$ ${precoNovo}
                        <div class="desconto">
                            <p>R$ ${desconto},00 de desconto</p>
                        </div>
                    </h2>

                `;
            });

            await db.collection('produtos')
            .doc(produto).get().then((doc) => {
                const urlPagamento = doc.data().url;
                divBotoes.innerHTML = `
                    <button id="comprar" class="btn-comprar">Comprar</button>
                    <button onclick="adicionarCarrinho('${produto}', '${produto}')" class="btn-addCarrinho">Adicionar ao carrinho</button>
                `;
            });

        }

        // AVALIACOES
        async function carregarAvaliacoes(produto) {
                const notaFinal = document.querySelector('h2[id="notaFinal"]');
                const pessoasFinal = document.querySelector('h2[id="pessoasFinal"]');
                avaliacoes.style.display = "flex";
                await db.collection('produtos')
                .doc(produto)
                .collection('avaliacoes')
                .onSnapshot((data) => {
                    const tamanho = data.size;
                    
                    data.docs.map((val) => {
                        const nome = val.id;
                        const estrelas = Number(val.data().estrelas);
                        const comentario = val.data().comentario;
                        const imagem = val.data().imagem;
                        const storageRef = storage.ref().child(`produtos/${produto}/avaliacoes/${imagem}`)
                        storageRef.getDownloadURL().then( function(url) {
                            if (estrelas === 0) {
                                comentarios.innerHTML += `
                                    <div class="comentario">
                                        <h1>${nome} <ion-icon name="checkmark-circle"></ion-icon></h1>
                                        <div class="flex">
                                            <ion-icon class="preta" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                        </div>
                                        <p>${comentario}</p>
                                        <img src="${url}">
                                    </div>
                                `;
                                
                            } else if (estrelas === 1) {
                                comentarios.innerHTML += `
                                    <div class="comentario">
                                        <h1>${nome} <ion-icon name="checkmark-circle"></ion-icon></h1>
                                        <div class="flex">
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                        </div>
                                        <p>${comentario}</p>
                                        <img src="${url}">
                                    </div>
                                `;        
                            } else if (estrelas === 2) {
                                comentarios.innerHTML += `
                                    <div class="comentario">
                                        <h1>${nome} <ion-icon name="checkmark-circle"></ion-icon></h1>
                                        <div class="flex">
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                        </div>
                                        <p>${comentario}</p>
                                        <img src="${url}">
                                    </div>
                                `;        
                            } else if (estrelas === 3) {
                                comentarios.innerHTML += `
                                    <div class="comentario">
                                        <h1>${nome} <ion-icon name="checkmark-circle"></ion-icon></h1>
                                        <div class="flex">
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                        </div>
                                        <p>${comentario}</p>
                                        <img src="${url}">
                                    </div>
                                `;        
                            } else if (estrelas === 4) {
                                comentarios.innerHTML += `
                                    <div class="comentario">
                                        <h1>${nome} <ion-icon name="checkmark-circle"></ion-icon></h1>
                                        <div class="flex">
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="preta" name="star"></ion-icon>
                                        </div>
                                        <p>${comentario}</p>
                                        <img src="${url}">
                                    </div>
                                `;        
                            } else if (estrelas === 5) {
                                comentarios.innerHTML += `
                                    <div class="comentario">
                                        <h1>${nome} <ion-icon name="checkmark-circle"></ion-icon></h1>
                                        <div class="flex">
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                            <ion-icon class="amarela" name="star"></ion-icon>
                                        </div>
                                        <p>${comentario}</p>
                                        <img src="${url}">
                                    </div>
                                `;        
                            }

                            pessoas++;
                            soma += estrelas;
                            notas = soma / tamanho;
                            notaFinal.innerHTML = `${notas.toFixed(1)} / 5`;  
                            if (!pessoasFinal) {
                                const pessoasFinalDois = document.querySelector('h2[id="pessoasFinal"]');
                                pessoasFinalDois.innerHTML = `${tamanho} Avaliações`;
                            } else {
                                pessoasFinal.innerHTML = `${tamanho} Avaliações`;
                            }
                            notaProduto(notas);
                        });
                    });
                });
            }

        async function notaProduto(notas) {
            const notadoproduto = document.querySelector('section[id="notadoproduto"]');
            const notadoprodutoDois = document.querySelector('section[id="notadoprodutodois"]');
            var nota = notas.toFixed(0);
            nota = Number(nota)
            if (nota === 0) {
                notadoproduto.innerHTML = await `
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                `;
                notadoprodutoDois.innerHTML = await `
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                `;
            } else if (nota === 1) {
                notadoproduto.innerHTML = await `
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                `;
                notadoprodutoDois.innerHTML = await `
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                `;
            } else if (nota === 2) {
                notadoproduto.innerHTML = await `
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                `;
                notadoprodutoDois.innerHTML = await `
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                `;
            } else if (nota === 3) {
                notadoproduto.innerHTML = await `
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                `;
                notadoprodutoDois.innerHTML = await `
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                `;
            } else if (nota === 4) {
                notadoproduto.innerHTML = await `
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                `;
                notadoprodutoDois.innerHTML = await `
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="preta" name="star"></ion-icon>
                `;
            } else if (nota === 5) {
                notadoproduto.innerHTML = await `
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                `;
                notadoprodutoDois.innerHTML = await `
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                    <ion-icon class="amarela" name="star"></ion-icon>
                `;
            }

            
        }


        // ENVIAR AVALIACAO
        async function enviarAvaliacao() {
            const nome = document.getElementById('nome').value;
            const nota = document.getElementById('mostrarNota').textContent.slice(0,1);
            const inputImagem = document.getElementById('imagem');
            const comentario = document.getElementById('comentario').value;
            const alertaNome = document.querySelector('strong[for="nome"]');
            const alertaNota = document.querySelector('strong[for="estrelas"]');
            const alertaImagem = document.querySelector('strong[for="imagem"]');
            const alertaComentario = document.querySelector('strong[for="comentario"]');
            if (nome) {
                alertaNome.innerHTML = '';
                if (nota !== '*') {
                    alertaNota.innerHTML = '';
                    if (comentario) {
                        alertaComentario.innerHTML = '';
                        const imagem = inputImagem.files[0];
                        if (imagem) {
                            alertaImagem.innerHTML = '';
                            // Crie uma referência para o local de armazenamento da imagem
                            const storageRef = storage.ref(`produtos/${termProduto}/avaliacoes/` + imagem.name);

                            // Faça o upload da imagem para o Firebase Storage
                            await storageRef.put(imagem).then(function (snapshot) {
                                db.collection('produtos')
                                .doc(termProduto)
                                .collection('avaliacoes')
                                .doc(nome).set({
                                    comentario: comentario,
                                    imagem: imagem.name,
                                    estrelas: nota
                                }).then((response) => {
                                    window.location.reload();
                                })        
                            }).catch(function (error) {
                                console.error("Erro ao enviar a imagem:", error);
                            });
                        } else {                    
                            alertaImagem.innerHTML = 'Campo obrigatório';
                        }
                    } else {
                        alertaComentario.innerHTML = 'Campo obrigatório';
                    }
                } else {
                    alertaNota.innerHTML = 'Campo obrigatório';
                }
            } else {
                alertaNome.innerHTML = 'Campo obrigatório';
            }
        }


    </script>

<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

</html>